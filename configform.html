<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>

<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="Описание страницы. Не менее 160 символов. " />
    <meta name="keywords" content="Здесь указываем список ключевых слов, разделенные запятой." />
    <link rel="stylesheet" href="configform.css">
    <script src="http://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous">
        </script>
    <title>Главная страница</title>
</head>

<body>
    <div class="main" ; text-align:rigth;>
        <h3>Настройка конфигурации</h3>
        <div class="elements">
            <div>
                <p>
                    <label>host</label>
                    <input type="text" size="30" id='host' />
                </p>
                <p>
                    <label>port</label>
                    <input type="text" size="30" id='port' />
                </p>
                <p>
                    <label>user name </label>
                    <input type="text" size="30" id='user' />
                </p>
                <p>
                    <label>user password</label>
                    <input type="text" size="30" id="password" />
                </p>
                <p>
                    <label>Период автообновления</label>
                    <input type="text" size="30" id="period" />
                </p>
                <p>
                    <input value="Сохранить настройки" name="buttonSave" type="button" id="buttonSave" />
                </p>
                <p class="update">
                    <input value="Обновить базу" name="buttonUpdate" type="button" id="buttonUpdate" />
                    <input value="Автоматическое обновление" name="buttonAutoUpdate" type="button" id="buttonAutoUpdate" />
                    <input value="Остановить автообновление" name="buttonStop" type="button" id="buttonStop" />
                </p>
                <p>
                    <label>Статус сервиса</label>
                    <input type="text" size="30" id ='serviceStatus' />
                </p>
                <p>
                    <label>История событий</label>                
                </p>
                <p>
                <textarea name='log' cols = "80" rows="12" id='log'></textarea>
                </p>
            </div>
            <script>
                $.getJSON('http://localhost:3000/config', data => {
                    console.log(data);
                    var host = document.getElementById('host').value = data.config.host;
                    var port = document.getElementById('port').value = data.config.port;
                    var user = document.getElementById('user').value = data.config.user;
                    var password = document.getElementById("password").value = data.config.password;
                    var period = document.getElementById("period").value = data.config.period;
                })

                $('#buttonSave').bind('click', function () {
                    console.log('Нажата');
                    data = {
                        host: document.getElementById('host').value,
                        port: document.getElementById('port').value,
                        user: document.getElementById('user').value,
                        password: document.getElementById('password').value,
                        period: document.getElementById('period').value
                    };
                    console.log(data);
                    $.post('http://localhost:3000/saveConfig', data);
                })

                $('#buttonUpdate').bind('click', function () {
                    console.log('Save нажата')
                    
                    $.post('http://localhost:3000/update');
                    window.location.reload();
                })

                $('#buttonAutoUpdate').bind('click', function () {
                    $.post('http://localhost:3000/autoUpdate');
                    window.location.reload();
                })

                $('#buttonStop').bind('click', function () {
                    $.post('http://localhost:3000/stop');
                    window.location.reload();
                })

                $.getJSON('http://localhost:3000/getStatus', data => {
                    console.log(data)
                    var serviceStatus = document.getElementById("serviceStatus").value = data.serviceStatus;
                })
                function setCaretPosition (elem, caretPos) {
                    if (document.selection) { // ie
                        elem.focus ();
                        var range = document.selection.createRange ();
                        range.moveStart ('character', -elem.value.length);
                        range.moveStart ('character', caretPos);
                        range.moveEnd ('character', 0);
                        range.select ();
                    } else if (elem.selectionStart || elem.selectionStart == '0') { // Mozilla
                        elem.selectionStart = caretPos;
                        elem.selectionEnd = caretPos;
                        elem.focus ();
                    }
                }
                document.getElementById("log").scrollTop=document.getElementById("log").scrollHeight;
                $.getJSON('http://localhost:3000/getLogfile', data => {
                    
                    var str ='';
                    for (i in data.array){ 
                        str = str + data.array[i] + '\n';
                    }
                    var log = document.getElementById('log').value = str;
                    
                    document.getElementById("log").scrollTop=document.getElementById("log").scrollHeight;

                })

            
            </script>
        </div>
        <div class='status_class'>

        </div>


    <!-- <div id="main">
        <div id="primary">
            <div id="content">
                Тут содержимое контента
            </div>
        </div>
        <div id="secondary">
            Содержимое сайдбара
        </div>
    </div> -->

</body>

</html>